
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mind Map with Literature Nodes</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    button {
      background-color: #0070f3;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    svg {
      background: white;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <button id="expand-all-btn">Expand All</button>
  <svg id="mindmap" width="3000" height="2500"></svg>

  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    const rawData = {
      name: "Surveillance and the City",
      children: [
        {
          name: "Negotiating Visibility",
          children: [
            { name: "Tactical Anonymity", children: [
              { name: "Encrypted Communication" },
              { name: "Pseudonymous Accounts" },
              { name: "Decentralized Networks" },
              { name: "Avoiding Biometric Surveillance" },
              { name: "Public Protest Strategies" }
            ]},
            { name: "Literature", literature: true, children: [
              { name: "Georg Simmel (1903)", reference: "Anonymity fosters freedom but also detachment in the metropolis." },
              { name: "Louis Wirth (1938)", reference: "Urban anonymity brings isolation but also freedom from control." },
              { name: "Jane Jacobs (1961)", reference: "Anonymity enables informal safety through 'eyes on the street'." },
              { name: "Richard Sennett (1977)", reference: "Loss of public anonymity erodes civic life." },
              { name: "Mike Davis (1990)", reference: "Militarized urban space challenges anonymity and freedom." },
              { name: "David Lyon (2001)", reference: "Surveillance undermines anonymity, reinforces discrimination." }
            ]},
            { name: "Anonymity vs Visibility", children: [
              { name: "Activist Trade-offs" },
              { name: "Governance Exploitation" },
              { name: "Corporate Data Pressure" }
            ]},
            { name: "Psychological Impact", children: [
              { name: "Behavioral Conformity" },
              { name: "Public Interaction Shifts" }
            ]},
            { name: "Legal Frameworks", children: [
              { name: "Privacy Laws" },
              { name: "Urban Planning & Surveillance" }
            ]}
          ]
        },
        {
          name: "Right to the City",
          children: [
            { name: "Literature", literature: true, children: [
              { name: "Lefebvre (1967)", reference: "Urban space should be collectively reimagined, not commodified." },
              { name: "Harvey (2008)", reference: "'A right to change ourselves by changing the city'." }
            ]},
            { name: "Public vs Private Space", children: [
              { name: "Legal Challenges" },
              { name: "Ownership & Access" }
            ]},
            { name: "Urban Design & Inclusion", children: [
              { name: "Participatory Planning" },
              { name: "Spatial Justice" }
            ]},
            { name: "Harvey & Lefebvreâ€™s Theories", children: [
              { name: "Democratic Space" },
              { name: "Production of Urban Life" }
            ]}
          ]
        }
      ]
    };

    const svg = d3.select("#mindmap");
    const g = svg.append("g").attr("transform", "translate(100,100)");
    svg.call(d3.zoom().on("zoom", (event) => {
      g.attr("transform", event.transform);
    }));

    const treeLayout = d3.tree().nodeSize([120, 280]);
    const root = d3.hierarchy(rawData);
    root.x0 = 0;
    root.y0 = 0;

    function collapse(node) {
      if (node.children) {
        node._children = node.children;
        node._children.forEach(collapse);
        node.children = null;
      }
    }
    root.children.forEach(collapse);

    function update(source) {
      treeLayout(root);
      const nodes = root.descendants();
      const links = root.links();

      const link = g.selectAll("path.link")
        .data(links, d => d.target.ancestors().map(n => n.data.name).join("/"));
      link.exit().remove();
      link.enter()
        .append("path")
        .attr("class", "link")
        .attr("fill", "none")
        .attr("stroke", "#ccc")
        .attr("stroke-width", 1.5)
        .merge(link)
        .transition()
        .duration(500)
        .attr("d", d3.linkVertical().x(d => d.x).y(d => d.y));

      const node = g.selectAll("g.node")
        .data(nodes, d => d.data.name);
      const nodeEnter = node.enter().append("g")
        .attr("class", "node")
        .attr("transform", d => `translate(${source.x0},${source.y0})`)
        .style("cursor", "pointer")
        .on("click", (event, d) => {
          if (d.children) {
            d._children = d.children;
            d.children = null;
          } else {
            d.children = d._children;
            d._children = null;
          }
          update(d);
          const scale = 1.5;
          const translate = [
            svg.node().clientWidth / 2 - d.x * scale,
            svg.node().clientHeight / 2 - d.y * scale
          ];
          svg.transition()
            .duration(750)
            .call(d3.zoom().transform, d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale));
        });

      nodeEnter.append(d => {
        return d.data.literature ? document.createElementNS(d3.namespaces.svg, "rect") :
                                    document.createElementNS(d3.namespaces.svg, "circle");
      })
        .attr("r", 5)
        .attr("width", d => d.data.literature ? 20 : null)
        .attr("height", d => d.data.literature ? 20 : null)
        .attr("x", d => d.data.literature ? -10 : null)
        .attr("y", d => d.data.literature ? -10 : null)
        .attr("fill", d => d.data.literature ? "#e67e22" : "#0070f3");

      nodeEnter.append("text")
        .attr("dy", "0.35em")
        .attr("x", d => (d.children || d._children) ? -12 : 12)
        .attr("text-anchor", d => (d.children || d._children) ? "end" : "start")
        .style("font-size", "14px")
        .text(d => d.data.name);

      nodeEnter.append("text")
        .filter(d => d.data.reference)
        .attr("dy", "2.2em")
        .attr("x", 0)
        .attr("text-anchor", "middle")
        .style("font-size", "12px")
        .style("fill", "#555")
        .text(d => d.data.reference);

      nodeEnter.transition().duration(500).attr("transform", d => `translate(${d.x},${d.y})`);
      node.transition().duration(500).attr("transform", d => `translate(${d.x},${d.y})`);

      nodes.forEach(d => {
        d.x0 = d.x;
        d.y0 = d.y;
      });
    }

    update(root);

    document.getElementById("expand-all-btn").addEventListener("click", () => {
      function expand(node) {
        if (node._children) {
          node.children = node._children;
          node._children = null;
        }
        if (node.children) node.children.forEach(expand);
      }
      expand(root);
      update(root);
    });
  </script>
</body>
</html>
